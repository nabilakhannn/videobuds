{% extends "base.html" %}
{% block title %}New Brand{% endblock %}

{% block content %}
<div class="max-w-3xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
    <!-- Page Header -->
    <div class="mb-8">
        <a href="{{ url_for('brands.list_brands') }}" class="inline-flex items-center text-sm text-gray-500 dark:text-gray-400 hover:text-gray-600 dark:hover:text-gray-300 mb-4 transition-colors">
            <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            Back to Brands
        </a>
        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">Create New Brand</h1>
        <p class="text-gray-500 dark:text-gray-400 mt-1">Define your brand identity, visual style, and content strategy</p>
    </div>

    <!-- Brand Form -->
    <form method="POST" action="{{ url_for('brands.create_brand') }}" class="space-y-8" id="brand-form">
        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
        <input type="hidden" name="colors" id="colors-json" value="[]">

        <!-- Basic Info -->
        <div class="bg-white dark:bg-[#1E1E1E] border border-[#26A0D8]/20 dark:border-[#26A0D8]/40 rounded-xl p-6">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-5">Basic Information</h2>
            <div class="space-y-5">
                <!-- Name -->
                <div>
                    <label for="name" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-1.5">Brand Name <span class="text-red-400">*</span></label>
                    <input type="text" id="name" name="name" required
                           value="{{ request.form.get('name', '') }}"
                           class="w-full px-4 py-2.5 bg-white dark:bg-[#141414] border border-[#26A0D8]/30 rounded-lg text-gray-900 dark:text-white placeholder-gray-400
                                  focus:outline-none focus:ring-2 focus:ring-[#F18523] focus:border-transparent transition-colors"
                           placeholder="e.g., TechVibe Studio">
                </div>

                <!-- Tagline -->
                <div>
                    <label for="tagline" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-1.5">Tagline</label>
                    <input type="text" id="tagline" name="tagline"
                           value="{{ request.form.get('tagline', '') }}"
                           class="w-full px-4 py-2.5 bg-white dark:bg-[#141414] border border-[#26A0D8]/30 rounded-lg text-gray-900 dark:text-white placeholder-gray-400
                                  focus:outline-none focus:ring-2 focus:ring-[#F18523] focus:border-transparent transition-colors"
                           placeholder="e.g., Innovation meets creativity">
                </div>

                <!-- Target Audience -->
                <div>
                    <label for="target_audience" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-1.5">Target Audience</label>
                    <textarea id="target_audience" name="target_audience" rows="3"
                              class="w-full px-4 py-2.5 bg-white dark:bg-[#141414] border border-[#26A0D8]/30 rounded-lg text-gray-900 dark:text-white placeholder-gray-400
                                     focus:outline-none focus:ring-2 focus:ring-[#F18523] focus:border-transparent transition-colors resize-none"
                              placeholder="Describe your ideal audience: demographics, interests, pain points...">{{ request.form.get('target_audience', '') }}</textarea>
                </div>
            </div>
        </div>

        <!-- Visual Identity -->
        <div class="bg-white dark:bg-[#1E1E1E] border border-[#26A0D8]/20 dark:border-[#26A0D8]/40 rounded-xl p-6">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-5">Visual Identity</h2>
            <div class="space-y-5">
                <!-- Visual Style -->
                <div>
                    <label for="visual_style" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-1.5">Visual Style Description</label>
                    <textarea id="visual_style" name="visual_style" rows="3"
                              class="w-full px-4 py-2.5 bg-white dark:bg-[#141414] border border-[#26A0D8]/30 rounded-lg text-gray-900 dark:text-white placeholder-gray-400
                                     focus:outline-none focus:ring-2 focus:ring-[#F18523] focus:border-transparent transition-colors resize-none"
                              placeholder="Describe the visual aesthetic: modern minimalist, bold pop art, warm organic...">{{ request.form.get('visual_style', '') }}</textarea>
                </div>

                <!-- Brand Colors -->
                <div>
                    <label class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-1.5">Brand Colors</label>
                    <p class="text-xs text-gray-500 mb-3">Choose up to 3 brand colors</p>
                    <div class="grid grid-cols-3 gap-4">
                        <div class="flex items-center space-x-3">
                            <input type="color" id="color_1" name="color_1"
                                   value="{{ request.form.get('color_1', '#3b82f6') }}"
                                   class="w-10 h-10 rounded-lg border border-[#26A0D8]/30 dark:border-[#26A0D8]/40 bg-gray-100 dark:bg-[#2A2A2A] cursor-pointer p-0.5">
                            <div>
                                <label for="color_1" class="text-xs text-gray-500 dark:text-gray-400">Primary</label>
                                <input type="text" name="color_1_hex"
                                       value="{{ request.form.get('color_1_hex', '#3b82f6') }}"
                                       class="block w-full mt-1 px-2 py-1 bg-white dark:bg-[#141414] border border-[#26A0D8]/30 rounded text-xs text-gray-900 dark:text-white font-mono
                                              focus:outline-none focus:ring-1 focus:ring-[#F18523]"
                                       pattern="^#[0-9A-Fa-f]{6}$" placeholder="#3b82f6">
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <input type="color" id="color_2" name="color_2"
                                   value="{{ request.form.get('color_2', '#8b5cf6') }}"
                                   class="w-10 h-10 rounded-lg border border-[#26A0D8]/30 dark:border-[#26A0D8]/40 bg-gray-100 dark:bg-[#2A2A2A] cursor-pointer p-0.5">
                            <div>
                                <label for="color_2" class="text-xs text-gray-500 dark:text-gray-400">Secondary</label>
                                <input type="text" name="color_2_hex"
                                       value="{{ request.form.get('color_2_hex', '#8b5cf6') }}"
                                       class="block w-full mt-1 px-2 py-1 bg-white dark:bg-[#141414] border border-[#26A0D8]/30 rounded text-xs text-gray-900 dark:text-white font-mono
                                              focus:outline-none focus:ring-1 focus:ring-[#F18523]"
                                       pattern="^#[0-9A-Fa-f]{6}$" placeholder="#8b5cf6">
                            </div>
                        </div>
                        <div class="flex items-center space-x-3">
                            <input type="color" id="color_3" name="color_3"
                                   value="{{ request.form.get('color_3', '#ec4899') }}"
                                   class="w-10 h-10 rounded-lg border border-[#26A0D8]/30 dark:border-[#26A0D8]/40 bg-gray-100 dark:bg-[#2A2A2A] cursor-pointer p-0.5">
                            <div>
                                <label for="color_3" class="text-xs text-gray-500 dark:text-gray-400">Accent</label>
                                <input type="text" name="color_3_hex"
                                       value="{{ request.form.get('color_3_hex', '#ec4899') }}"
                                       class="block w-full mt-1 px-2 py-1 bg-white dark:bg-[#141414] border border-[#26A0D8]/30 rounded text-xs text-gray-900 dark:text-white font-mono
                                              focus:outline-none focus:ring-1 focus:ring-[#F18523]"
                                       pattern="^#[0-9A-Fa-f]{6}$" placeholder="#ec4899">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Content Strategy -->
        <div class="bg-white dark:bg-[#1E1E1E] border border-[#26A0D8]/20 dark:border-[#26A0D8]/40 rounded-xl p-6">
            <h2 class="text-lg font-semibold text-gray-900 dark:text-white mb-5">Content Strategy</h2>
            <div class="space-y-5">
                <!-- Content Pillars -->
                <div>
                    <label for="content_pillars" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-1.5">Content Pillars</label>
                    <input type="text" id="content_pillars" name="content_pillars"
                           value="{{ request.form.get('content_pillars', '') }}"
                           class="w-full px-4 py-2.5 bg-white dark:bg-[#141414] border border-[#26A0D8]/30 rounded-lg text-gray-900 dark:text-white placeholder-gray-400
                                  focus:outline-none focus:ring-2 focus:ring-[#F18523] focus:border-transparent transition-colors"
                           placeholder="Education, Behind the scenes, Product showcase, Community (comma separated)">
                    <p class="mt-1 text-xs text-gray-500">Separate with commas. These are the themes your content revolves around.</p>
                </div>

                <!-- Hashtags -->
                <div>
                    <label for="hashtags" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-1.5">Hashtags</label>
                    <input type="text" id="hashtags" name="hashtags"
                           value="{{ request.form.get('hashtags', '') }}"
                           class="w-full px-4 py-2.5 bg-white dark:bg-[#141414] border border-[#26A0D8]/30 rounded-lg text-gray-900 dark:text-white placeholder-gray-400
                                  focus:outline-none focus:ring-2 focus:ring-[#F18523] focus:border-transparent transition-colors"
                           placeholder="#brand, #marketing, #creative (comma separated)">
                    <p class="mt-1 text-xs text-gray-500">Default hashtags to include in campaign posts.</p>
                </div>

                <!-- Never Do -->
                <div>
                    <label for="never_do" class="block text-sm font-medium text-gray-600 dark:text-gray-300 mb-1.5">Never Do (Guardrails)</label>
                    <textarea id="never_do" name="never_do" rows="3"
                              class="w-full px-4 py-2.5 bg-white dark:bg-[#141414] border border-[#26A0D8]/30 rounded-lg text-gray-900 dark:text-white placeholder-gray-400
                                     focus:outline-none focus:ring-2 focus:ring-[#F18523] focus:border-transparent transition-colors resize-none"
                              placeholder="Things to avoid: no stock photo cliches, never use Comic Sans, avoid controversial topics...">{{ request.form.get('never_do', '') }}</textarea>
                    <p class="mt-1 text-xs text-gray-500">Describe what the brand should never do or say in its content.</p>
                </div>
            </div>
        </div>

        <!-- Submit -->
        <div class="flex items-center justify-end space-x-3 pt-2">
            <a href="{{ url_for('brands.list_brands') }}"
               class="px-5 py-2.5 text-sm font-medium text-gray-600 dark:text-gray-300 hover:text-gray-900 dark:hover:text-white transition-colors">
                Cancel
            </a>
            <button type="submit"
                    class="px-6 py-2.5 bg-[#F18523] hover:bg-[#D97218] text-white text-sm font-medium rounded-lg
                           focus:outline-none focus:ring-2 focus:ring-[#F18523] focus:ring-offset-2 focus:ring-offset-white dark:focus:ring-offset-gray-900
                           transition-colors shadow-lg shadow-[#F18523]/20">
                Create Brand
            </button>
        </div>
    </form>
</div>

<!-- Sync color pickers with hex inputs and collect colors into JSON -->
<script>
    function syncColors() {
        var colors = [];
        document.querySelectorAll('input[name^="color_"][name$="_hex"]').forEach(function(hex) {
            var v = hex.value.trim();
            if (v && /^#[0-9A-Fa-f]{6}$/.test(v)) colors.push(v);
        });
        document.getElementById('colors-json').value = JSON.stringify(colors);
    }

    document.querySelectorAll('input[type="color"]').forEach(function(picker) {
        var hexInput = picker.parentElement.querySelector('input[type="text"]');
        if (hexInput) {
            picker.addEventListener('input', function() {
                hexInput.value = picker.value;
                syncColors();
            });
            hexInput.addEventListener('input', function() {
                if (/^#[0-9A-Fa-f]{6}$/.test(hexInput.value)) {
                    picker.value = hexInput.value;
                }
                syncColors();
            });
        }
    });

    // Sync on page load and before submit
    syncColors();
    document.getElementById('brand-form').addEventListener('submit', syncColors);
</script>
{% endblock %}
